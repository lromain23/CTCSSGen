/*
 * File:   main.h
 * Author: luc
 *
 * Created on February 26, 2023, 11:37 AM
 */

#ifndef main_H
#include <16F690.h>
#include <math.h>
#define main_H
#fuses HS
#fuses NOPROTECT
#fuses BROWNOUT
#fuses NOWDT
#case
#define AMP 127
#define SIN_SAMPLES 32
#define SIN16_SAMPLES 16
#define TIMER2_PERIOD 255
#define MCU_FREQ_MHZ 2500000
#define T1_PRESCALER 1
// Timer1 latency consumes 4 instructions from 
// T1_disable to T1 re-enabled.
#define TIMER1_LATENCY 24
#use delay (clock=10MHz,crystal=10MHz)
#use fast_io(A)
#use fast_io(B)
#use fast_io(C)

const unsigned int8 SinTable16[] ={ 
    AMP * 0,
    AMP * 0.2,
    AMP * 0.38,
    AMP * 0.56,
    AMP * 0.71,
    AMP * 0.83,
    AMP * 0.92,
    AMP * 0.98,
    AMP * 1.0,
    AMP * 0.98,
    AMP * 0.92,
    AMP * 0.83,
    AMP * 0.71,
    AMP * 0.56,
    AMP * 0.38,
    AMP * 0.20};

unsigned int sint( unsigned int& v);
void set_ctcss_period(unsigned int& p);
unsigned int16 d_val;
unsigned int16 t1_val;
unsigned int8 increment;
//unsigned int16 update_dc_count;
unsigned int8 ctcss_sel;
int1 enableCTCSS;
int1 reverseBurst;
int1 RBFlag;
#define ENABLE_CTCSS_PIN PIN_B4
#define REVERSE_BURST_PIN PIN_B5

void initialize(void);

// Timer1 values for each CTCSS frequency when running at
// FOSC = 10MHz

const unsigned int16 CTCSS_T1_FREQ[] = {		// RC[2:0]:RA[2:0]
    MCU_FREQ_MHZ/SIN_SAMPLES/T1_PRESCALER/67,    	// 0 (1166)
    MCU_FREQ_MHZ/SIN_SAMPLES/T1_PRESCALER/69.3,	 	// 1
    MCU_FREQ_MHZ/SIN_SAMPLES/T1_PRESCALER/71.9,		// 2
    MCU_FREQ_MHZ/SIN_SAMPLES/T1_PRESCALER/74.4,		// 3
    MCU_FREQ_MHZ/SIN_SAMPLES/T1_PRESCALER/77,		// 4
    MCU_FREQ_MHZ/SIN_SAMPLES/T1_PRESCALER/79.7,		// 5
    MCU_FREQ_MHZ/SIN_SAMPLES/T1_PRESCALER/82.5,		// 6
    MCU_FREQ_MHZ/SIN_SAMPLES/T1_PRESCALER/85.4,		// 7
    MCU_FREQ_MHZ/SIN_SAMPLES/T1_PRESCALER/88.5,		// 8
    MCU_FREQ_MHZ/SIN_SAMPLES/T1_PRESCALER/91.5,		// 9
    MCU_FREQ_MHZ/SIN_SAMPLES/T1_PRESCALER/94.8,		// 10
    MCU_FREQ_MHZ/SIN_SAMPLES/T1_PRESCALER/97.4,		// 11
    MCU_FREQ_MHZ/SIN_SAMPLES/T1_PRESCALER/100,		// 12
    MCU_FREQ_MHZ/SIN_SAMPLES/T1_PRESCALER/103.5,	// 13
    MCU_FREQ_MHZ/SIN_SAMPLES/T1_PRESCALER/107.2,	// 14
    MCU_FREQ_MHZ/SIN_SAMPLES/T1_PRESCALER/110.9,	// 15
    MCU_FREQ_MHZ/SIN_SAMPLES/T1_PRESCALER/114.8,	// 16
    MCU_FREQ_MHZ/SIN_SAMPLES/T1_PRESCALER/118.8,	// 17
    MCU_FREQ_MHZ/SIN_SAMPLES/T1_PRESCALER/123,		// 18
    MCU_FREQ_MHZ/SIN_SAMPLES/T1_PRESCALER/127.3,	// 19
    MCU_FREQ_MHZ/SIN_SAMPLES/T1_PRESCALER/131.8,	// 20
    MCU_FREQ_MHZ/SIN_SAMPLES/T1_PRESCALER/136.5,	// 21
    MCU_FREQ_MHZ/SIN_SAMPLES/T1_PRESCALER/141.3,	// 22
    MCU_FREQ_MHZ/SIN_SAMPLES/T1_PRESCALER/146.2,	// 23
    MCU_FREQ_MHZ/SIN_SAMPLES/T1_PRESCALER/151.4,	// 24
    MCU_FREQ_MHZ/SIN_SAMPLES/T1_PRESCALER/156.7,	// 25
    MCU_FREQ_MHZ/SIN_SAMPLES/T1_PRESCALER/162.2,	// 26
    MCU_FREQ_MHZ/SIN_SAMPLES/T1_PRESCALER/167.9,	// 27
    MCU_FREQ_MHZ/SIN_SAMPLES/T1_PRESCALER/173.8,	// 28
    MCU_FREQ_MHZ/SIN_SAMPLES/T1_PRESCALER/179.9,	// 29
    MCU_FREQ_MHZ/SIN_SAMPLES/T1_PRESCALER/186.2,	// 30
    MCU_FREQ_MHZ/SIN_SAMPLES/T1_PRESCALER/192.8,	// 31
    MCU_FREQ_MHZ/SIN_SAMPLES/T1_PRESCALER/203.5,	// 32 (384)
    MCU_FREQ_MHZ/SIN_SAMPLES/T1_PRESCALER/206.5,	// 33
    MCU_FREQ_MHZ/SIN_SAMPLES/T1_PRESCALER/210.7,	// 34
    MCU_FREQ_MHZ/SIN_SAMPLES/T1_PRESCALER/218.1,	// 35
    MCU_FREQ_MHZ/SIN_SAMPLES/T1_PRESCALER/225.7,	// 36 (346))
    MCU_FREQ_MHZ/SIN16_SAMPLES/T1_PRESCALER/229.1,	// 37
    MCU_FREQ_MHZ/SIN16_SAMPLES/T1_PRESCALER/233.6,	// 38
    MCU_FREQ_MHZ/SIN16_SAMPLES/T1_PRESCALER/241.8,	// 39
    MCU_FREQ_MHZ/SIN16_SAMPLES/T1_PRESCALER/250.3,	// 40
    MCU_FREQ_MHZ/SIN16_SAMPLES/T1_PRESCALER/254.1,	// 41 (307.5)
};
const unsigned int8 ctcss_table_size=sizeof(CTCSS_T1_FREQ)/2;
#endif

